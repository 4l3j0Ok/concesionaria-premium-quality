---
import Layout from "../layouts/Layout.astro";
import CarGridComponent from "../components/CarGrid";
import Contact from "../components/Contact";
import Stats from "../components/Stats.astro";

const apiUrl = import.meta.env.API_URL;
const carsApiUrl = `${apiUrl}/cars`;

// Obtener el total de cars para las estadísticas (esto es rápido)
let totalCars = 0;
try {
  const response = await fetch(carsApiUrl);
  const data = await response.json();
  totalCars = data.total || data.items?.length || 0;
} catch (error) {
  console.error("Error fetching cars count:", error);
}

const catalogStats = [
  {
    number: totalCars,
    label: "Vehículos disponibles",
  },
];
---

<Layout>
  <main>
    <section class="catalog-header">
      <h1>Catálogo de Vehículos</h1>
      <p class="subtitle">
        Explora nuestra amplia selección de vehículos disponibles
      </p>
      <Stats stats={catalogStats} />
    </section>

    <CarGridComponent client:load apiUrl={carsApiUrl} />

    <Contact client:load />
  </main>
</Layout>

<style>
  main {
    background-color: white;
    display: flex;
    flex-direction: column;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    width: 80%;
    padding: 2em;
    padding-bottom: 5em;
    margin-bottom: 5em;
    margin-top: 2em;
  }

  .catalog-header {
    text-align: center;
    margin-bottom: 2em;
  }

  .catalog-header h1 {
    font-size: 2.5rem;
    color: var(--primary-color);
    margin-bottom: 0.5em;
  }

  .subtitle {
    font-size: 1.2rem;
    color: #666;
    margin-bottom: 2em;
  }

  @media (max-width: 768px) {
    main {
      width: 95%;
      padding: 1em;
    }

    .catalog-header h1 {
      font-size: 2rem;
    }

    .subtitle {
      font-size: 1rem;
    }
  }
</style>
